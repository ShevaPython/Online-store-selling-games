{% extends 'base.html' %}

{% block title %}All games{% endblock %}

{% block menu_genres %}
    <li class="dropdown"><a href="#">Genres</a>
        <ul>
            {% for genre in genres %}
                <li><a href="{{ url_for('search_genre', gerne_name=genre.name) }}">{{ genre.name }}</a></li>
            {% endfor %}
        </ul>
    </li>
{% endblock %}

{% block card_count %}
    <li><a href="{{ url_for('basket.index_basket') }}">Basket: {{ cart_count }}</a></li>
{% endblock card_count %}

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul class=flashes>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

{% block content %}
    <section class="page-banner">
        <div class="auto-container">
            <div class="inner-container clearfix">
                <h1>Search by genre</h1>
                <ul class="bread-crumb clearfix">
                    {% for genre in genres %}
                        <li><a href="{{ url_for('search_genre', gerne_name=genre.name) }}">{{ genre.name }}</a></li>
                    {% endfor %}
                </ul>

            </div>
        </div>
    </section>
    {% for game in all_games %}

        <section class="player-info-section">
            <div class="auto-container">
                <div class="row clearfix">
                    <!--Text Column-->
                    <div class="text-column col-lg-6 col-md-6 col-sm-12">
                        <div class="inner wow fadeInRight">
                            <div class="title-box">
                                <div class="user-title">{{ game.name }}</div>
                                <div class="user-info">Price :: {{ game.price }}</div>
                            </div>
                            <div class="text">There are many variations of passages of lorem ipsum available, but the
                                majority have suffered alteration in some form, by injected humour, or simply free
                                textinh randomised words which don't look even slightly believable. If you are going to
                                use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing
                                hidden in the middle of text.
                            </div>
                            <form id="add-to-basket-form" action="{{ url_for('basket.add_basket', game_id=game.id) }}"
                                  method="post">
                                <button type="submit" class="add-to-basket-btn">Add to Basket</button>
                            </form>

                            </form>

                        </div>
                    </div>
                    <!--Image Column-->
                    <div class="image-column col-lg-6 col-md-6 col-sm-12">
                        <div class="inner wow fadeInLeft">
                            <figure class="image"><img
                                    {% if game.photo %}
                                        src="{{ game.photo }}" alt="">
                                    {% else %}
                                        src="{{ game.photo }}" alt="">
                                    {% endif %}
                            </figure>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    {% endfor %}
    <script>

        // Обработчик события отправки формы
        document.addEventListener('submit', function (event) {
            if (event.target.matches('#add-to-basket-form')) {
                event.preventDefault(); // Предотвращаем отправку формы

                // Отправляем AJAX-запрос на сервер
                fetch(event.target.action, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message === 'Game has been successfully added to the basket') {
                            // Отображаем сообщение об успешном добавлении игры
                            alert('Game has been successfully added to the basket');

                        } else {
                            // Отображаем сообщение об ошибке
                            alert('Failed to add the game to the basket');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        });
    </script>
{% endblock %}


